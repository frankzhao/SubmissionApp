<div class="row">
  <div class="col-sm-5 col-sm-offset-2">
    <h2>Submission for <%=  link_to @assignment.name, assignment_url(@assignment) %></h2>
    <small>Submitted at <%= @submission.created_at %></small>
  </div>
</div>

<div class="row">
  <div class="col-sm-5 col-sm-offset-2">
    <% if @submission.permitted_users.include?(current_user) %>
      <h3> Submitter is anonymous </h3>
    <% elsif current_user == @submission.user %>
      <% unless @assignment.already_due %>
        <%= link_to "Submit new version", new_assignment_assignment_submission_url(
                            @assignment), :class => "btn btn-default"%>
      <% end %>
    <% else %>
      <h3> <%= link_to(@submission.user.name,user_url(@submission.user)) %>
        (u<%= @submission.user.uni_id%>)
      </h3>
    <% end %>
  </div>
</div>

<div class="row">
  <div class="col-sm-5 col-sm-offset-2">
    <% @assignment.marking_categories.each do |category| %>
      <p><%= category.name %>: <%= category.mark_for_submission(@submission) || "-"%>/<%= category.maximum_mark %></p>
    <% end %>
  </div>
</div>


<% if @assignment.submission_format == "plaintext" %>
  <%= render :partial => "plaintext",
                      :locals => { :submission => @submission} %>
<% elsif @assignment.submission_format == "zipfile" %>
  <%= render :partial => "zipfile",
                      :locals => { :submission => @submission} %>
<% end %>


<div class="row">
  <div class="col-sm-6 col-sm-offset-3">
    <div id="comments">
      <% @comments.each do |comment| %>
        <div class="comment">
          <h4>
            <% if comment.user %>
              <%= @submission.context_name(comment.user, current_user) %>
            <% else %>
              Automatic comment
            <% end %>
          </h4>
          <p>
            <%= comment.body %>
          </p>
        </div>
      <% end %>

      <div class="comment">
        <h4>New comment</h4>
        <form method="POST"
              action="<%= assignment_assignment_submission_comments_url(
                        @assignment, @submission)%>"
              enctype="multipart/form-data"
              role="form"
              class="form-inline"
              >
          <%= tag(:input, :type => "hidden", :name => request_forgery_protection_token.to_s, :value => form_authenticity_token) %>
          <div class="form-group">
            <textarea name="comment[body]" class="form-control"></textarea>
          </div>

          <div class="form-group">
            Attach file: (currently this doesn't do anything)
            <%= file_field 'upload', 'datafile' %>
          </div>

          <% @assignment.marking_categories.each do |category| %>
          <div class="form-group">
            <%= category.name %> (<%= category.maximum_mark %> marks)
            <input id="mark_<%= category.name %>"
                   name="mark[<%= category.id%>]"
                   class="form-control">
          </div>
          <% end %>

          <input class="btn btn-primary" type="submit" value="Post comment">
        </form>
      </div>
    </div>
  </div>
</div>