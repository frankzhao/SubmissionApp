<div class="row">
  <div class="col-sm-5 col-sm-offset-2">
    <h2><%= @assignment.name %></h2>
  </div>

  <% if @relation == :convener || current_user.is_admin %>
    <div class="col-sm-3">
      <div class="btn-group pull-right pull-down extra_space_button">
        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
          Options <span class="caret"></span>
        </button>
        <ul class="dropdown-menu" role="menu">
          <li><%= link_to "Edit", edit_assignment_url(@assignment) %></li>
          <li><%= link_to "View all marks as csv",
                assignment_marks_url(@assignment) %></li>
          <li><%= link_to "Peer review cycles",
                assignment_cycles_url(@assignment) %></li>
          <li><%= link_to "Marking scheme",
                assignment_marking_categories_url(@assignment) %></li>
          <li class="divider"></li>
          <li><%= link_to "Download all submissions as zip",
                assignment_zipfile_url(@assignment) %></li>
        </ul>
      </div>
    </div>
  <% end %>
</div>
<div class="row">
  <div class="col-sm-8 col-sm-offset-2">

    <%= render :partial => "show_info",
                            :locals => { :assignment => @assignment,
                                        :courses => @courses} %>

    <h3>Submissions</h3>
        <% if @relation == :staff %>
          As a tutor, you can't currently download all of your students' submissions as a
          zip. Sorry about that. You can, however, view and download them
          individually.
        <% elsif @relation == :convener %>
        <p><%= link_to "Download all submissions as zip",
                "/assignments/#{@assignment.id}/submissions.zip" %></p>
        <% end %>


      <%= link_to("Submit test assignment",
                new_assignment_assignment_submission_url(@assignment)) %>


<!-- <p>TODO: currently when you download all submissions as a zip, none of them are labelled, and some of them are old submissions. How should I label them? Which ones should be downloaded?</p> -->
    <ul>
      <% @submissions.each do |submission| %>
        <li>
          <%= link_to("#{submission.user.name} (u#{submission.user.uni_id})",
                  assignment_assignment_submission_url(@assignment, submission)) %>
         <!-- TODO: add this feature back in -->
         <!--  <%# unless submission.mark %>
            <span class="label label-default">(unmarked)</span>
          <%# end %> -->
          <% unless submission.submission_permissions.empty? %>
            (visible to <%= submission.permitted_users.pluck(:name).join(", ") %>)
            <% if submission.comments.where_not_automated.count == 0 %>
              <span class="label label-default">Uncommented</span>
            <% end %>
          <% end %>
          <% unless submission.is_finalized %>
            <span class="label label-default">Not finalized</span>
          <% end %>
        </li>
      <% end %>
    </ul>
  </div>
</div>
