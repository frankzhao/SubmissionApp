<% content_for :title, @course.name %>

<div class="row">
  <div class="col-sm-9 col-sm-offset-2">
    <h2><%= @course.name %></h2>

    <p><em>Course convener: <%= link_to @convener.name, user_url(@convener) %></em></p>

    <p><%= link_to "Create new group type", new_group_type_url , :class => "btn btn-primary btn-sm" %>
    <% if current_user == @convener || current_user.is_admin %>
      <%= link_to("Enroll students and staff", new_course_user_url(@course), :class => "btn btn-primary btn-sm") %>
    </p>
    <% end %>

    <% if @assignments %>
      <h3>Assignments</h3>
      <ul>
        <% @assignments.each do |assignment| %>
          <li>
            <%= link_to assignment.name, assignment_url(assignment) %>
          </li>
        <% end %>
      </ul>
    <% end %>

    <% if @group_types %>
      <% @group_types.each do |group_type| %>

        <h3><%= link_to group_type.name, group_type_url(group_type) %></h3>

        <% if current_user == @convener %>
    <p><%= link_to "New assignment", new_group_type_assignment_url(group_type) %></p>

    <p><%= link_to "Delete "+group_type.name, group_type_url(group_type), :method => :delete %> </p>
        <% end %>

          <ul>
            <% group_type.groups.each do |group| %>
              <li>
                <%= link_to group.name, group_url(group) %>
              </li>
            <% end %>
          </ul>
      <% end %>
    <% end %>

    <h3>Staff</h3>
    <table id="staff" class="table table-bordered table-striped">
      <% @staffs.each do |staff| %>
      <tr>
        <td> <%= link_to staff.name, user_url(staff) %> </td>
      </tr>
      <% end %>
    </table>

    <% if (@course.staff+[@course.convener]).include?(current_user) or current_user.is_admin %>
      <h3>Students</h3>
      <table id="students" class="table table-bordered table-striped">
        <tr>
          <th><h5>Student</h5></th>
          <th><h5>ID</h5></th>
        </tr>
        <% @students.each do |student| %>
            <tr>
              <!-- User info -->
              <td><%= link_to student.name %></td>
              <td><%= link_to "u" + student.uni_id.to_s, user_url(student) %></td>
            </tr>
        <% end %>
      </table>
    
    <% elsif @course.students.include? current_user %>
    <% else %>
      <em>Note that you aren't enrolled in this course--you'd
             see more if you were.</em>
    <% end %>
  </div>
</div>

